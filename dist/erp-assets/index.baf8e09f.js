var q=Object.defineProperty,z=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var w=(d,t,r)=>t in d?q(d,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):d[t]=r,R=(d,t)=>{for(var r in t||(t={}))P.call(t,r)&&w(d,r,t[r]);if(T)for(var r of T(t))H.call(t,r)&&w(d,r,t[r]);return d},U=(d,t)=>z(d,K(t));import{r as j,be as $,u as G,aj as I,b as s,j as u,aI as g,B as F,aV as M,bj as W,t as J,n as Q,M as O,E as X,bH as Y}from"./vendor.475cee01.js";/* empty css               *//* empty css               */import{MenuTypeTag as Z}from"./index.54dd0fc7.js";import{l as m,a as _,A,F as ee}from"./index.b2d919ca.js";import{L as ae}from"./index.3b332b51.js";import{T as v}from"./index.926a4b8b.js";import{S as V,F as se,a as te}from"./index.7f218578.js";import{s as B}from"./index.9a618fcf.js";import"./statusTag.1d433c1a.js";import"./index.4f759f94.js";import"./entrepot.95f11770.js";import"./index.ab849bc2.js";/* empty css               */import"./shopStore.936c9d2c.js";import"./index.cc99a160.js";/* empty css              */import"./index.599b9453.js";/* empty css               */import"./index.36bc3114.js";/* empty css              */import"./style.4b618b1b.js";import"./clipboard.a809cca0.js";/* empty css               */import"./schema.524eafb7.js";/* empty css               */import"./schema.035d054d.js";/* empty css              */function Ue(){const[d,t]=j.exports.useState([]),[r,h]=j.exports.useState([]),[a,y]=j.exports.useState(null),[N,S]=j.exports.useState(!1),[b]=$(),{clientMenuList:E}=G(l=>l),x=I(l=>{if(!!l)return m.info(l).then(i=>{var o,n,c,f;t(((n=(o=i.data)==null?void 0:o.data)==null?void 0:n.menuIds)||[]),y(i.data.data),h(((f=(c=i.data.data)==null?void 0:c.roleUserInfoVOList)==null?void 0:f.map(e=>e.userId))||[])})},{manual:!0}),C=I(()=>{if(!(!(a==null?void 0:a.id)||!N))return m.getRoleUsers(a.id).then(l=>l.data.data)},{refreshDeps:[a==null?void 0:a.id,N]}),{data:p,loading:L,run:k}=I(()=>m.get({pageNum:1,pageSize:30}).then(l=>{var o;const i=l.data.data.list[0];return a||(y(i),x.run(i==null?void 0:i.id),h((o=i==null?void 0:i.roleUserInfoVOList)==null?void 0:o.map(n=>n.userId))),l.data.data.list}));return s(_,{formRef:b,createRequest:m.create,updateRequest:m.saveRoleMenu,refreshRequest:k,children:s(A.Consumer,{children:({showType:l,setShowType:i,createAction:o,updateAction:n})=>{var c,f;return u("div",{className:"bg-white p-4 syb-content-h] test-1",children:[u(g.Row,{gutter:[20,0],className:"h-full",children:[u(g.Col,{span:6,className:"overflow-y-auto h-full border-r border-neutral-3 pr-4",children:[s(v,{title:"\u7528\u6237\u7EC4",children:s(F,{icon:s(M,{}),type:"primary",size:"small",className:"ml-auto",loading:L||x.loading,onClick:()=>{i(V.create)},children:"\u6DFB\u52A0"})}),s(ae,{loading:L||x.loading,data:p==null?void 0:p.map(e=>({name:e.roleName,id:e.id})),active:a==null?void 0:a.id,onActive:e=>{x.run(e.id)},onDelete:e=>B(()=>m.remove(e.id),"\u5220\u9664").then(()=>{(a==null?void 0:a.id)===e.id&&y(p==null?void 0:p[0]),k()})})]}),u(g.Col,{span:9,className:"overflow-y-auto h-full border-r border-neutral-3 pr-4 flex flex-col",children:[s(v,{title:"\u529F\u80FD\u6743\u9650",className:"mt-0.5"}),s("div",{className:"flex overflow-y-auto",children:s(W,{showLine:!0,checkable:!0,autoExpandParent:!0,checkStrictly:!0,checkedKeys:d,onCheck:(e,D)=>{t(e)},fieldNames:{title:"menuName",key:"menuId"},renderTitle:e=>u("div",{children:[s("span",{className:"mr-2",children:e.menuName}),s(Z,{size:"small",menuType:e.menuType})]}),treeData:E||[]})}),s("div",{className:"mt-10 gap-4 flex justify-end",children:s(F,{type:"primary",loading:n.loading,onClick:()=>{n.run({roleId:a==null?void 0:a.id,menuIdList:d})},children:"\u4FDD\u5B58"})})]}),u(g.Col,{span:9,className:"overflow-y-auto h-full",children:[s(v,{title:"\u6210\u5458\u5217\u8868",className:"mt-0.5"}),u(J,{size:[10],children:[(c=a==null?void 0:a.roleUserInfoVOList)==null?void 0:c.map(e=>s(Q,{checkable:!0,color:"arcoblue",checked:!0,children:e.userName},e.userId)),s(F,{type:"primary",size:"small",loading:C.loading,icon:s(M,{}),onClick:()=>{var e;h(((e=a==null?void 0:a.roleUserInfoVOList)==null?void 0:e.map(D=>D.userId))||[]),S(!0)},children:"\u6DFB\u52A0"})]})]})]}),s(O,U(R({},se),{confirmLoading:o==null?void 0:o.loading,onCancel:()=>{i(null),b.resetFields()},onOk:async()=>{const e=await b.validate();l===V.create&&o.run(e)},visible:!!l,title:`${te[l]}\u7528\u6237\u7EC4`,children:s(ee,{form:b,labelLength:8,span:24,formItemConfigList:[{schema:{label:"\u7528\u6237\u7EC4\u540D\u79F0",span:12,field:"roleName",required:!0},control:"input"}]})})),s(O,{style:{width:"700px"},unmountOnExit:!0,confirmLoading:o==null?void 0:o.loading,onCancel:()=>{S(!1)},onOk:()=>B(()=>m.saveRoleUser({roleId:a.id,userIdList:r.map(e=>Number(e))})),visible:N,title:`\u7F16\u8F91 ${a==null?void 0:a.roleName} \u6210\u5458`,children:s(X,{loading:C.loading,className:"flex justify-center",children:s(Y,{listStyle:{width:300},simple:{retainSelectedItems:!0},dataSource:((f=C.data)==null?void 0:f.list.map(e=>({key:e.userId,value:e.userName})))||[],targetKeys:r||[],onChange:e=>{h(e)},titleTexts:["\u7528\u6237\u5217\u8868","\u5DF2\u6DFB\u52A0"]})})})]})}})})}export{Ue as default};
