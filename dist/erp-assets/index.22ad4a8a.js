var Y=Object.defineProperty,Q=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var O=(o,s,i)=>s in o?Y(o,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[s]=i,w=(o,s)=>{for(var i in s||(s={}))K.call(s,i)&&O(o,i,s[i]);if(_)for(var i of _(s))ee.call(s,i)&&O(o,i,s[i]);return o},M=(o,s)=>Q(o,Z(s));import{r as d,u as H,e as ue,aj as D,l as R,H as V,j as c,b as t,B as b,bX as te,aT as ae,aE as G,i as se,bf as P,aI as q,D as ne,aW as re,at as oe,al as ie,aY as le,F as ce,E as de,b5 as me,bc as pe,M as Fe,m as he}from"./vendor.475cee01.js";/* empty css              *//* empty css               *//* empty css               *//* empty css               */import{s as E}from"./shipment.968b8b17.js";import{F as U,S as ge,s as W}from"./index.b2d919ca.js";import{s as I,c as z,S as J}from"./index.9a618fcf.js";import Ce from"./schema.dd64c86b.js";import{s as Ee}from"./shopStore.936c9d2c.js";import{c as fe}from"./index.ab849bc2.js";import"./index.7f218578.js";import"./index.4f759f94.js";import"./entrepot.95f11770.js";import"./index.cc99a160.js";/* empty css              */import"./index.599b9453.js";import"./index.36bc3114.js";import"./style.4b618b1b.js";import"./clipboard.a809cca0.js";/* empty css               */import"./schema.524eafb7.js";import"./schema.035d054d.js";import"./shopee.417df029.js";const xe="Product is duplicate with another product in the same shop";var be=({shopId:o})=>{var r,a;const[s,i]=d.exports.useState({}),[p,B]=d.exports.useState(!1),F=H(e=>e.userInfo),[L,f]=d.exports.useState([]),[k,N]=d.exports.useState(1),[n,m]=d.exports.useState([]);ue("categortyAttributeFillInfo",{defaultValue:{}});const{data:g,run:C,loading:T}=D(async e=>E.getUpdateErrors(w({userLoginAccount:F.userLoginAccount,shopId:o},e)).then(u=>u.data),{refreshDeps:[o]}),x=((r=g==null?void 0:g.data)==null?void 0:r.list)||[],$=x.filter(e=>!0).sort((e,u)=>e.itemName.localeCompare(u.itemName,"zh-Hans-CN")).map((e,u)=>M(w({},e),{index:u+1}))||[],A=R.exports.uniqBy(x,e=>e.categoryId).map(e=>({label:`${e.displayCategoryName}(${x.filter(u=>u.categoryId===e.categoryId).length}\u4E2A)`,value:e.categoryId}));D(async e=>{!F.userLoginAccount||await I(()=>E.saveCategortyAttribute({userLoginAccount:F.userLoginAccount,data:e}),"\u4FDD\u5B58")},{manual:!0,debounceWait:300});const S=D(async()=>{if(!(n==null?void 0:n.length))return V.warning("\u8BF7\u9009\u62E9\u5546\u54C1");await z({content:"\u5728\u7C7B\u76EE\u5C5E\u6027\u51FA\u73B0\u95EE\u9898\uFF0C\u5F71\u54CD\u4FEE\u6539\u51FA\u8D27\u65F6\u95F4\u65F6\uFF0C\u518D\u4F7F\u7528\u6B64\u64CD\u4F5C\uFF01\uFF08\u5982\u679C\u9519\u8BEF\u7C7B\u578B\u662F\uFF1A\u3010\u5546\u54C1\u91CD\u590D\u3011\uFF0C\u8BF7\u79FB\u6B65\u5220\u9664\u64CD\u4F5C\uFF09",okText:"\u786E\u8BA4\u4FEE\u6539"}),await I(()=>E.changeCategorty({userLoginAccount:F.userLoginAccount,shopId:o,itemIds:n,isToCurrentCategoryOther:!0}).then(e=>{var l;const u=((l=e.data.data)==null?void 0:l.filter(h=>h.status==="error"))||[];if(u.length)throw new Error(`\u51FA\u9519${u.length}\u4E2A\u5546\u54C1\uFF0C\u539F\u56E0\uFF1A${R.exports.uniq(u.map(h=>h.msg).join("\u3001"))}`);return e}),"\u8BBE\u7F6E"),m([])},{manual:!0}),y=D(async()=>{if(!(n==null?void 0:n.length))return V.warning("\u8BF7\u9009\u62E9\u5546\u54C1");await z({content:`\u786E\u8BA4\u5220\u9664${n.length}\u4E2A\u5546\u54C1`,okText:"\u786E\u8BA4\u5220\u9664"}),await I(()=>E.deleteItems({userLoginAccount:F.userLoginAccount,shopId:o,itemIds:n}),"\u5220\u9664"),m([])},{manual:!0});return c("div",{className:"pr-4",children:[p?null:t(U,{className:"mb-4 mt-2",initialValues:{repeat:0},formItemConfigList:[{schema:{label:"\u5546\u54C1\u540D\u79F0",field:"item_name"}},{schema:{label:"\u5546\u54C1ID",field:"item_id"}},{schema:{label:"\u9519\u8BEF\u7C7B\u76EE",field:"category_id"},control:"select",controlProps:{options:A}},{schema:{label:"\u5546\u54C1\u91CD\u590D",field:"repeat"},control:"radio",controlProps:{options:[{label:"\u5168\u90E8",value:0},{label:"\u662F",value:1},{label:"\u5426",value:2}]}}],onValuesChange:(e,u)=>{i(u)}}),t("div",{className:"flex mb-4",children:p?t("div",{className:"w-full",children:t(b,{icon:t(te,{}),type:"text",onClick:()=>{B(!1)},children:"\u8FD4\u56DE"})}):c("div",{className:"w-full mb-4 flex gap-4",children:[c(b,{type:"primary",status:"warning",loading:S.loading,onClick:()=>{S.run()},children:["\u8BBE\u7F6E\u7C7B\u76EE\u4E3A\uFF1A\u5176\u4ED6"," ",n.length?`(${n.length})\u4E2A`:""]}),c(b,{type:"primary",status:"danger",loading:y.loading,onClick:()=>{y.run()},children:["\u5220\u9664\u5546\u54C1"," ",n.length?`(${n.length})\u4E2A`:""]}),t(b,{icon:t(ae,{}),className:"ml-auto",type:"primary",onClick:()=>{N(1),C({page:1,pageSize:20})},children:"\u5237\u65B0"})]})}),p?c("div",{children:[t(G,{title:"\u4FDD\u5B58\u6210\u529F\u540E\u53EF\u524D\u5F80\u3010\u4FEE\u6539\u51FA\u8D27\u5929\u6570\u3011\uFF0C\u91CD\u65B0\u53D1\u8D77\u4FEE\u6539",type:"info",className:"mb-4"}),t(se.Title,{heading:6,children:"\u4FEE\u6539\u51FA\u9519\u5546\u54C1\u7C7B\u76EE(\u4E0D\u5305\u542B\u91CD\u590D\u7684\u5546\u54C1\u51FA\u9519\u7C7B\u76EE)"}),t(P.Group,{className:"w-full",value:L,onChange:e=>{A.every(u=>e.includes(u.value))?e.push("all"):e.includes("all")&&e.splice(e.indexOf("all"),1),f(e)},children:c(q.Row,{children:[t(q.Col,{span:6,style:{marginBottom:12},children:t(P,{value:"all",onChange:e=>{f(e?[...A.map(u=>u.value),"all"]:[])},children:"\u5168\u9009"})}),A.map(e=>t(q.Col,{span:6,style:{marginBottom:12},children:t(P,{value:e.value,children:e.label})},e.value))]})}),t(ne,{})]}):null,p?null:t(re,{loading:T,rowSelection:{type:"checkbox",selectedRowKeys:n,onChange:e=>{m(e)},onSelectAll:e=>{m(e?$.map(u=>u.itemId):[])}},data:x,rowKey:e=>e.itemId,pagePosition:"tr",pagination:{sizeOptions:[20,50],defaultPageSize:20,showTotal:!0,total:((a=g==null?void 0:g.data)==null?void 0:a.total)||0,current:k},onChange:({current:e,defaultPageSize:u})=>{N(e),C({page:e,pageSize:u})},columns:[{title:"\u5E8F\u53F7",dataIndex:"index",width:100,render:(e,u,l)=>l+1},{title:"\u5546\u54C1\u540D\u79F0",dataIndex:"item_name",width:300,render(e,u,l){return c("span",{children:[t(oe,{target:"_blank",href:`https://seller.shopee.tw/portal/product/${u.itemId}`,children:u.itemName}),"\uFF08",u.itemId,"\uFF09"]})}},{title:"\u9519\u8BEF\u539F\u56E0",dataIndex:"errorMsg",render(e){const u=e==null?void 0:e.replace(xe,"\u5546\u54C1\u91CD\u590D").replace("please check and update","\u8BF7\u68C0\u67E5\u540E\u518D\u66F4\u65B0").replace("is mandatory required","\u662F\u5FC5\u586B\u9879").replace("Attribute","\u5C5E\u6027").replace("requests too frequent","\u9891\u7387\u8FC7\u9AD8\uFF0C\u91CD\u8BD5\u5373\u53EF");return t("div",{children:u})}},{title:"\u7C7B\u76EE",width:200,dataIndex:"displayCategoryName"}]})]})};const We=o=>{const{userInfo:s}=H(r=>r),i=d.exports.useRef(),[p,B]=d.exports.useState(),[F,L]=d.exports.useState(),[f,k]=d.exports.useState(null),[N,n]=d.exports.useState(),[m,g]=d.exports.useState(),[C,T]=d.exports.useState([]),[x]=ie.useForm(),{run:$,loading:A}=D(async()=>{const r=await x.validate();return I(()=>E.update(M(w({},r),{userLoginAccount:s.userLoginAccount,shopId:p==null?void 0:p.id}))).then(()=>{B(null)})},{manual:!0}),S=D(({id:r,shopName:a})=>I(()=>E.apply({userLoginAccount:s.userLoginAccount,shopId:r,shopName:a}).then(e=>(L(null),i.current.refreshSearchTable(),e))),{manual:!0}),y=fe({dictCode:"update_day_notice",value:"notice_1"});return d.exports.useEffect(()=>{let r;function a(){if(!!((C==null?void 0:C.map(u=>u.id))||[]).length)return E.getProcess({userLoginAccount:s.userLoginAccount,shopIds:C.map(u=>u.id)}).then(u=>{k(u.data.data)}).finally(()=>{r=setTimeout(a,5e3)})}return a(),()=>{clearTimeout(r)}},[JSON.stringify(C)]),c("div",{className:"p-4 bg-white",children:[t(ge,{ref:i,getListRequest:(...r)=>Ee.getList(...r).then(async a=>{const e=await E.getConsumerList({userLoginAccount:s.userLoginAccount,pageNum:1,pageSize:1e3});return a.data.data.list.forEach(u=>{var l,h,v;u.consumerInfo=(v=(h=(l=e==null?void 0:e.data)==null?void 0:l.data)==null?void 0:h.list)==null?void 0:v.find(j=>j.shopId===u.id)}),a}),onDataChange:r=>{T(r.list)},formItemConfigList:[...Ce,{schema:{label:"\u64CD\u4F5C",field:"actions"},render(r,a){var h,v,j;const e=(h=f==null?void 0:f.progress)==null?void 0:h[a.id];(v=e==null?void 0:e.list)==null||v.filter(X=>X.status==="error");const u=Number(((j=e==null?void 0:e.value)==null?void 0:j.replace("%",""))||0),l=e==null?void 0:e.errorMsg;return c("div",{className:"flex gap-2",children:[c("div",{className:"flex flex-col items-center",children:[t(b,{type:"text",className:"-ml-4",icon:t(le,{}),onClick:()=>{B(a)},children:"\u4FEE\u6539\u51FA\u8D27\u5929\u6570"}),u===1&&!l?t("div",{className:"flex gap-2 items-center",children:t(J,{tagInfos:[{text:c(ce,{children:[t(de,{size:12,className:"!inline-block mr-1"}),"\u6B63\u5728\u83B7\u53D6\u5546\u54C1\u6570\u91CF..."]}),value:0,color:"green"}],value:0})}):null,u&&u!==1||l?c("div",{className:"pl-4",children:[t(me,{className:"mb-1",percent:u}),(e==null?void 0:e.duration)||l?l?c("div",{className:"text-sm max-w-[600px]",style:{color:"red"},children:[`\u5546\u54C1\u6570\u91CF\uFF1A${e.goodsTotal}\uFF0C\u65F6\u957F\uFF1A${W(e.duration)}${l}`,t(b,{type:"primary",className:"mt-2",status:"danger",size:"mini",onClick:()=>{g({title:`${a.shopName} - \u4FEE\u6539\u51FA\u9519\u5217\u8868`,shopId:a.id}),n(a.id)},children:"\u67E5\u770B\u9519\u8BEF"})]}):t(J,{tagInfos:[{text:`\u5546\u54C1\u6570\u91CF\uFF1A${e.goodsTotal}\uFF0C\u65F6\u957F\uFF1A${W(e.duration)}`,value:0,color:"green"}],value:0}):null]}):null]}),t("div",{children:t(b,{type:"text",className:"-ml-4",loading:S.loading&&(F==null?void 0:F.id)===a.id,icon:t(pe,{}),status:"danger",onClick:async()=>{await z({title:"\u6E29\u99A8\u63D0\u793A",okText:"\u7533\u8BF7",content:c("div",{children:[t("div",{className:"mb-2",children:"\u786E\u5B9A\u7533\u8BF7\u6743\u9650\uFF1F"}),t(G,{type:"success",content:(y==null?void 0:y.data)||""})]}),okButtonProps:{status:"default"}}),L(a),S.run(a)},children:"\u7533\u8BF7\u6743\u9650"})})]})}}],name:"\u5E97\u94FA\u6388\u6743"}),t(Fe,{title:"\u4FEE\u6539\u51FA\u8D27\u5929\u6570",unmountOnExit:!0,visible:!!p,onCancel:()=>{B(null)},confirmLoading:A,onConfirm:()=>{$()},children:t(U,{form:x,formItemConfigList:[{schema:{span:24,label:"\u51FA\u8D27\u5929\u6570",field:"day",required:!0},control:"number",controlProps:{max:30,min:1}},{schema:{span:24,label:"\u5FFD\u7565\u5546\u54C1ID",field:"ids"},control:"textarea",controlProps:{placeholder:"\u8F93\u5165\u5546\u54C1ID\uFF0C\u7528\u9017\u53F7\u9694\u5F00"}}]})}),t(he,{title:m==null?void 0:m.title,width:"80%",visible:!!N,onCancel:()=>n(null),unmountOnExit:!0,onOk:()=>n(null),children:t(be,{shopId:m==null?void 0:m.shopId})})]})};export{We as default};
