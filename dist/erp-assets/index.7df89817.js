var U=Object.defineProperty,H=Object.defineProperties;var M=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var L=(r,e,a)=>e in r?U(r,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[e]=a,o=(r,e)=>{for(var a in e||(e={}))W.call(e,a)&&L(r,a,e[a]);if(w)for(var a of w(e))z.call(e,a)&&L(r,a,e[a]);return r},c=(r,e)=>H(r,M(e));import{r as h,af as C,j as g,t as J,b as t,n as K,B as S,aV as G,M as k,E as j,bG as $,R as Q,e as Y,D as X,aW as Z,l as ee,al as ae,F as te,bH as ue,aY as se,aI as N,G as v,c as le}from"./vendor.581b77cf.js";import{E as re}from"./EntrepotList.42dc2b87.js";/* empty css               */import{e as F,c as V}from"./entrepot.937b7e14.js";import{x as ie,s as O,y as ne,S as oe}from"./index.25c2c087.js";import{S as de,F as P,d as R,f as ce}from"./index.04370c22.js";import{useEntrepotInfo as me}from"./hooks.500ba1c2.js";/* empty css               *//* empty css               */import{b as fe}from"./index.e1a43827.js";import{R as pe,a as he}from"./index.506e78cc.js";import{S as D}from"./common.c903c973.js";import"./schema.5fe644d2.js";import"./index.27d57268.js";import"./index.16154476.js";import"./index.913b50b4.js";/* empty css              */import"./index.32c418c3.js";import"./index.7553f754.js";import"./shopStore.b2b8e7ba.js";import"./index.110ec091.js";/* empty css              *//* empty css              */import"./style.4b618b1b.js";import"./clipboard.a809cca0.js";/* empty css               */import"./schema.a4de4ea7.js";/* empty css               */import"./schema.035d054d.js";var be=r=>{var l;const{entrepotId:e}=r,[a,n]=h.exports.useState(!1),[x,m]=h.exports.useState(!1),[i,b]=h.exports.useState([]),{run:p,data:f,loading:B}=C(async()=>{if(!!e)return F.getAllocationUser(e).then(s=>s.data.data.list).then(s=>(b(s.map(d=>d.userId)),s))},{manual:!1,refreshDeps:[e]}),u=C(()=>!a||u.data?u.data:ie.list({pageNum:1,pageSize:300}).then(s=>s.data.data),{refreshDeps:[a]});return h.exports.useEffect(()=>{a&&b((f==null?void 0:f.map(s=>s.userId))||[])},[a]),g("div",{children:[g(J,{size:[10],children:[f==null?void 0:f.map(s=>t(K,{checkable:!0,color:"arcoblue",checked:!0,children:s.userName},s.userId)),t(S,{type:"primary",size:"small",loading:u.loading||B,icon:t(G,{}),onClick:()=>{n(!0)},children:"\u6DFB\u52A0"})]}),t(k,{style:{width:"700px"},unmountOnExit:!0,confirmLoading:x,onCancel:()=>{n(!1)},onOk:()=>(m(!0),O(()=>F.allocation({entrepotId:e,userIdList:i})).then(()=>{p(),n(!1)}).finally(()=>{m(!1)})),visible:a,title:"\u6DFB\u52A0\u7528\u6237",children:t(j,{loading:u.loading,className:"flex justify-center",children:t($,{listStyle:{width:300},simple:{retainSelectedItems:!0},dataSource:(((l=u.data)==null?void 0:l.list)||[]).toSorted((s,d)=>Number(i.includes(s.id))-Number(i.includes(d.id))).map(s=>({key:s.id,value:s.userName||s.userLoginAccount}))||[],showSearch:!0,targetKeys:i||[],onChange:s=>{b(s)},searchPlaceholder:"\u8BF7\u8F93\u5165",titleTexts:["\u7528\u6237\u5217\u8868","\u5DF2\u6DFB\u52A0"]})})})]})},ge=({entrepotId:r})=>{const e=Q.useRef();return h.exports.useEffect(()=>{var a;(a=e.current)==null||a.refreshSearchTable()},[r]),t(de,{ref:e,name:"\u5BC4\u4EF6\u4EBA\u7BA1\u7406",requestQueryTransform:a=>c(o({},a),{entrepotId:r}),getListRequest:F.getSenderList,createRequest:a=>F.insertSender(c(o({},a),{entrepotId:r})),updateRequest:F.updateSender,removeRequest:F.removeSender,createInitialValue:{isDefault:!1},formItemConfigList:[{schema:{field:"details",label:"\u5BC4\u4EF6\u4EBA\u59D3\u540D",span:24,rules:[{required:!0,validator:(a,n)=>{ne(a)?n():n("\u8BF7\u8F93\u5165\u4E2D\u6587\u59D3\u540D")},message:"\u8BF7\u8F93\u5165\u4E2D\u6587\u59D3\u540D"}]},isCreate:!0},{schema:{label:"\u9ED8\u8BA4",field:"isDefault"},render(a){return t(oe,{tagInfos:[{text:"\u662F",value:!0,color:"green"},{text:"\u5426",value:!1}],value:a})},formItemProps:{triggerPropName:"checked"},control:"switch",isCreate:!0}]})};const q={0:"base_packing",1:"entry_charge",2:"first_air_freight",3:"first_sea_freight",4:"first_express_freight",5:"first_leg_sea_freight",6:"warehousing_charge"};var Fe=r=>{var B;const{entrepotId:e,className:a}=r,[n,x]=Y("cost-filter",{defaultValue:{platform:"0",region:"TW"}}),m=C(async u=>e?await Promise.all(u.map(s=>V.getSetting(o({entrepotId:e,feeType:s},n)).then(d=>d.data.data.list))):null,{manual:!0}),{data:i,loading:b}=C(()=>fe.getListByDictCode([...Object.values(q),"cost_setting","membership_level"]).then(u=>u.data.data.list).then(u=>(m.run(u.filter(l=>l.dictCode==="cost_setting").map(l=>l.dictValue)),u)),{manual:!1,refreshDeps:[e,JSON.stringify(n)]}),p=h.exports.useMemo(()=>{var u;return(u=i==null?void 0:i.filter(l=>l.dictCode==="membership_level"))==null?void 0:u.map(l=>({label:l.displayName,value:l.dictValue}))},[JSON.stringify(i)]),f=h.exports.useCallback(u=>p?p.map(l=>({title:l.label,dataIndex:`${l.value}.expense`,render:(s,d)=>t(pe,{title:"\u4EF7\u683C",value:s||0,type:he.Number,notRefres:!0,onChange:y=>{const A=c(o({},n),{expense:y,entrepotId:e,feeType:u,membershipLevel:l.value,settingItemValue:d.settingItemValue}),E=d[l.value];return(E==null?void 0:E.id)&&(A.id=E.id),V.setSetting(A)}})})):[],[e,JSON.stringify(n),JSON.stringify(p),e]);return g(j,{className:a,loading:m.loading||b,children:[t(P,{initialValues:n,formItemConfigList:[{schema:{label:"\u5E73\u53F0",field:"platform"},control:"dictSelector",controlProps:{dictCode:"platform_type"}},{schema:{label:"\u533A\u57DF",field:"region"},control:"dictSelector",controlProps:{dictCode:"region"}}],onChange:(u,l)=>{x(l)}}),(B=i==null?void 0:i.filter(u=>u.dictCode==="cost_setting"))==null?void 0:B.map((u,l)=>{var s;return g("div",{children:[t(X,{orientation:"left",children:u.displayName}),t(Z,{borderCell:!0,rowKey:"feeType",pagination:!1,columns:[{title:"\u6536\u8D39\u7C7B\u76EE",dataIndex:"feeType"},...f(u.dictValue)],data:(s=i==null?void 0:i.filter(d=>d.dictCode===q[l]))==null?void 0:s.map(d=>{const y=p.reduce((A,E)=>{var T;const I=(T=m.data)==null?void 0:T[l].find(_=>_.membershipLevel===E.value&&_.settingItemValue===d.dictValue);return A[E.value]=I?ee.exports.pick(I,["expense","id"]):{value:0,id:null},A},{});return o({feeType:d.displayName,settingItemValue:d.dictValue},y)})})]},`${e}-${u.dictValue}`)}),t(k,{visible:!1,children:t(P,{formItemConfigList:[{schema:{field:"feeType",label:"\u6536\u8D39\u7C7B\u76EE"}},{schema:{field:"membershipLevel",label:"\u4F1A\u5458\u7B49\u7EA7"},control:"dictSelector",controlProps:{dictCode:"membership_level"}},{schema:{field:"fee",label:"\u6536\u8D39\u91D1\u989D"}},{schema:{field:"status",label:"\u72B6\u6001"}},{schema:{field:"action",label:"\u64CD\u4F5C"}}]})})]})},Ee=({className:r,entrepotId:e})=>{var b,p,f;const[a,n]=h.exports.useState(!1),[x]=ae.useForm(),m=C(()=>F.getEntrepotParams(e),{manual:!1,refreshDeps:[e]});console.log((b=m.data)==null?void 0:b.data.data);const i=C(async()=>{const B=await x.validate();await O(()=>{var u,l;return F.setEntrepotParams(c(o(o({},((l=(u=m.data)==null?void 0:u.data)==null?void 0:l.data)||{}),B),{entrepotId:e}))}).then(u=>(n(!1),u))},{manual:!0});return h.exports.useEffect(()=>{n(!1)},[e]),g("div",{className:r,children:[t("div",{className:"flex gap-4 mb-4",children:a?g(te,{children:[t(S,{onClick:()=>{n(!1)},loading:i.loading,children:"\u53D6\u6D88"}),t(S,{type:"primary",status:"success",icon:t(ue,{}),loading:i.loading,onClick:()=>{i.run()},children:"\u4FDD\u5B58"})]}):t(S,{type:"primary",icon:t(se,{}),onClick:()=>{n(!0)},children:"\u7F16\u8F91"})}),t(j,{className:"block",loading:m.loading||i.loading,children:m.loading?null:t(P,{form:x,formType:a?R.default:R.preview,initialValues:c(o({},((f=(p=m.data)==null?void 0:p.data)==null?void 0:f.data)||{}),{1:!0,2:!0,3:"50x30"}),span:12,labelCol:{style:{textAlign:"left"}},formItemConfigList:[c(o({},D),{schema:{label:"\u626B\u7801\u5165\u5E93\u662F\u5426\u5206\u4ED3\u4F4D",field:"whetherDivideSpace"}}),c(o({},D),{schema:{label:"\u5F85\u6263\u5934\u7A0B\u8D39\u7528\u8BA2\u5355\u81EA\u52A8\u6263\u8D39",field:"autoFeeDeduction"}}),{schema:{label:"\u4ED3\u4F4D\u6253\u5370\u6A21\u7248",field:"warehousePrintingTemplate"},control:"radio",controlProps:{options:[{label:"100x100",value:"100x100"},{label:"50x30",value:"50x30"}]}},{schema:{label:"\u4E0A\u67B6\u670D\u52A1\u8D39",field:"shelfServiceCharge"},control:"number"},{schema:{label:"\u888B\u53F7\u6253\u5370\u6A21\u7248",field:"bagNumberPrintTemplate"},control:"radio",controlProps:{options:[{label:"100x100",value:"100x100"},{label:"50x30",value:"50x30"}]}},{schema:{label:"\u51FA\u8D27\u5355\u6C34\u5370",field:"shippingNoteWatermarking"}},{schema:{label:"\u5165\u5E93\u6570\u91CF",field:"quantityInStorage"},control:"number"},{schema:{label:"\u51FA\u8D27\u5355\u6253\u5370\u6A21\u7248",field:"shippingOrderPrintingTemplate"},control:"radio",controlProps:{options:ce}},{schema:{label:"\u51FA\u8D27\u5355\u96C6",field:"shippingOrderSet"}},{schema:{label:"\u51FA\u8D27\u5355\u672B",field:"endOfShipment"}},{schema:{label:"\u51FA\u8D27\u5355\u865A\u62DF\u53F7\u7801",field:"shippingOrderVirtualNumber"}},{schema:{label:"\u6536\u4EF6\u540D\u79F0",field:"recipientName"}},{schema:{label:"\u6536\u4EF6\u624B\u673A\u53F7",field:"recipientPhone"}},{schema:{label:"\u6536\u4EF6\u5730\u5740",field:"recipientAddress"},control:"textarea"},{schema:{label:"\u5BC4\u4EF6\u540D\u79F0",field:"senderName"}},{schema:{label:"\u5BC4\u4EF6\u624B\u673A\u53F7",field:"senderPhone"}},{schema:{label:"\u5BC4\u4EF6\u5730\u5740",field:"senderAddress"},control:"textarea"},{schema:{label:"\u88C5\u888B\u9884\u8B66\u91CD\u91CF",field:"baggingWarningWeight"}},c(o({},D),{schema:{label:"\u51FA\u5E93\u6253\u5370\u9762\u5355",field:"printOutSheet"}}),c(o({},D),{schema:{label:"\u6253\u5305\u4E0B\u5355\u6263\u8FDB\u5E97\u8D39\u7528",field:"placeOrderfeeDeduction"}}),c(o({},D),{schema:{label:"\u79E4\u94FE\u63A5",field:"scaleLink"}}),c(o({},D),{schema:{label:"\u88C5\u888B\u81EA\u52A8\u7533\u8BF7\u9762\u5355",field:"autoApplyForm"}}),c(o({},D),{schema:{label:"PDA\u4E0A\u67B6\u662F\u5426\u5165\u5E93",field:"whetherPda"}}),{schema:{label:"\u7279\u5FEB\u8BBE\u7F6E",field:"expressSetting"}},{schema:{label:"\u7A7A\u8FD0\u8BBE\u7F6E",field:"airTransportSetup"}}]})})]})},De={"entrepot-setting-tabs":"_entrepot-setting-tabs_1svlf_1"},Ye=()=>{const r=me({isPureList:!0}),{activeEntrepot:e,entrepotLoading:a}=r;return console.log(!a&&!e),t("div",{className:"bg-white p-4 main-content-box overflow-hidden",children:g(N.Row,{gutter:[20,0],className:"h-full",children:[t(N.Col,{span:6,className:"border-r border-neutral-3 pr-4 h-full overflow-y-auto",children:t(re,{entrepotInfoHandle:r})}),e?t(N.Col,{span:18,className:"pr-6 h-full",children:g(v,{defaultActiveTab:"\u8D39\u7528\u8BBE\u7F6E",lazyload:!0,className:le("h-full flex-col flex",De["entrepot-setting-tabs"]),children:[t(v.TabPane,{title:"\u8D39\u7528\u8BBE\u7F6E",children:t(Fe,{className:"!block px-4",entrepotId:e==null?void 0:e.id})},"\u8D39\u7528\u8BBE\u7F6E"),t(v.TabPane,{title:"\u4EBA\u5458\u8BBE\u7F6E",children:t(be,{entrepotId:e==null?void 0:e.id})},"\u4EBA\u5458\u8BBE\u7F6E"),t(v.TabPane,{title:"\u5BC4\u4EF6\u4EBA\u59D3\u540D",children:e?t(ge,{entrepotId:e.id}):null},"\u5BC4\u4EF6\u4EBA\u59D3\u540D"),t(v.TabPane,{title:"\u4ED3\u5E93\u53C2\u6570\u8BBE\u7F6E",className:"h-full overflow-auto",children:t(Ee,{className:"px-4 overflow-hidden",entrepotId:e==null?void 0:e.id})},"\u4ED3\u5E93\u53C2\u6570\u8BBE\u7F6E")]})}):null]})})};export{Ye as default};
