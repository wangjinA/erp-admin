var _=Object.defineProperty,$=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var M=(o,i,r)=>i in o?_(o,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[i]=r,N=(o,i)=>{for(var r in i||(i={}))W.call(i,r)&&M(o,r,i[r]);if(q)for(var r of q(i))Q.call(i,r)&&M(o,r,i[r]);return o},C=(o,i)=>$(o,J(i));import{r as p,bc as X,af as I,b as s,j as u,aI as S,B as A,aV as O,bh as Y,s as Z,F as ee,t as ae,n as se,M as V,E as te,bG as ie}from"./vendor.581b77cf.js";/* empty css               *//* empty css               */import{J as re,s as E}from"./index.db58e438.js";import{MenuTypeTag as ne}from"./index.7f96845b.js";import{t as oe}from"./tenantry.a040ead3.js";import{l as m,a as de,A as le,F as ue}from"./index.8be05bc7.js";import{L as me}from"./index.913b50b4.js";import{T}from"./index.32c418c3.js";import{S as R,F as ce,a as pe}from"./index.16154476.js";import"./index.e0cc53da.js";import"./statusTag.1d433c1a.js";import"./index.f4301f1e.js";import"./entrepot.1530b3cd.js";import"./index.da423918.js";/* empty css               */import"./shopStore.7a17f05b.js";import"./index.110ec091.js";/* empty css              */import"./index.31bdb461.js";/* empty css               */import"./index.d4629795.js";/* empty css              */import"./style.4b618b1b.js";import"./clipboard.a809cca0.js";/* empty css               */import"./schema.292ea05a.js";/* empty css               */import"./schema.035d054d.js";/* empty css              */function Ge(){const[o,i]=p.exports.useState([]),[r,x]=p.exports.useState([]),[a,v]=p.exports.useState(null),[L,k]=p.exports.useState(!1),[f,P]=p.exports.useState(null),[z,U]=p.exports.useState(!1),[g]=X(),H=re(),h=I(n=>{if(!!n)return m.info(n).then(t=>{var d,l,j,b;i(((l=(d=t.data)==null?void 0:d.data)==null?void 0:l.menuIds)||[]),v(t.data.data),x(((b=(j=t.data.data)==null?void 0:j.roleUserInfoVOList)==null?void 0:b.map(y=>y.userId))||[])})},{manual:!0}),D=I(()=>{if(!!L)return oe.getDPList({pageNum:1,pageSize:300}).then(n=>n.data.data)},{refreshDeps:[a==null?void 0:a.id,L]}),{data:c,loading:w,run:B}=I(()=>m.get({pageNum:1,pageSize:30}).then(n=>{var d;const t=n.data.data.list[0];return a||(v(t),h.run(t==null?void 0:t.id),x(((d=t==null?void 0:t.roleUserInfoVOList)==null?void 0:d.map(l=>l.userId))||[])),n.data.data.list})),{loading:K,run:G}=I((n,t)=>E(()=>m.update(n),"\u4FEE\u6539").then(d=>t()),{manual:!0});return s(de,{formRef:g,createRequest:m.create,updateRequest:m.saveRoleMenuByAdmin,refreshRequest:B,children:s(le.Consumer,{children:({showType:n,setShowType:t,createAction:d,updateAction:l,resetAndRefreshHandle:j})=>{var b,y;return u("div",{className:"bg-white p-4 syb-content-h] test-1",children:[u(S.Row,{gutter:[20,0],className:"h-full",children:[u(S.Col,{span:6,className:"overflow-y-auto h-full border-r border-neutral-3 pr-4",children:[s(T,{title:"\u7528\u6237\u7EC4",children:s(A,{icon:s(O,{}),type:"primary",size:"small",className:"ml-auto",loading:w||h.loading,onClick:()=>{t(R.create)},children:"\u6DFB\u52A0"})}),s(me,{loading:w||h.loading,data:c==null?void 0:c.map(e=>({name:e.roleName,id:e.id,_HideDelete:e.systemAcquiesce===1&&e.backStatus,_HideEdit:e.systemAcquiesce===1&&e.backStatus})),active:a==null?void 0:a.id,onActive:e=>{h.run(e.id)},onUpdate:e=>{P(e),t(R.edit)},onDelete:e=>E(()=>m.remove(e.id),"\u5220\u9664").then(()=>{(a==null?void 0:a.id)===e.id&&v(c==null?void 0:c[0]),B()})})]}),u(S.Col,{span:9,className:"overflow-y-auto h-full border-r border-neutral-3 pr-4 flex flex-col",children:[s(T,{title:"\u529F\u80FD\u6743\u9650",className:"mt-0.5"}),s("div",{className:"flex overflow-y-auto",children:s(Y,{checkable:!0,checkedKeys:o,onCheck:(e,F)=>{i(e)},autoExpandParent:!0,checkStrictly:!0,fieldNames:{title:"menuName",key:"menuId"},renderTitle:e=>u("div",{children:[s("span",{className:"mr-2",children:e.menuName}),s(ne,{size:"small",menuType:e.menuType})]}),treeData:H.data||[]})}),s("div",{className:"mt-10 gap-4 flex justify-end",children:s(A,{type:"primary",loading:l.loading,onClick:()=>{l.run({roleId:a==null?void 0:a.id,menuIdList:o})},children:"\u4FDD\u5B58"})})]}),u(S.Col,{span:9,className:"overflow-y-auto h-full",children:[s(T,{title:"\u6210\u5458\u5217\u8868",className:"mt-0.5"}),(a==null?void 0:a.systemAcquiesce)===1&&(a==null?void 0:a.backStatus)?s(Z,{className:"mt-20",status:"success",title:"\u5168\u90E8\u5E97\u94FA\u7528\u6237",subTitle:"\u65E0\u6CD5\u7F16\u8F91\uFF0C\u9ED8\u8BA4\u7528\u6237\u62E5\u6709\u7684\u83DC\u5355\u6743\u9650"}):s(ee,{children:u(ae,{size:[10],wrap:!0,children:[(b=a==null?void 0:a.roleUserInfoVOList)==null?void 0:b.map(e=>s(se,{checkable:!0,color:"arcoblue",checked:!0,children:e.userName},e.userId)),s(A,{type:"primary",size:"small",loading:D.loading,icon:s(O,{}),onClick:()=>{var e;x(((e=a==null?void 0:a.roleUserInfoVOList)==null?void 0:e.map(F=>F.userId))||[]),k(!0)},children:"\u6DFB\u52A0"})]})})]})]}),s(V,C(N({},ce),{confirmLoading:K||d.loading,onCancel:()=>{t(null),g.resetFields()},onOk:async()=>{const e=await g.validate();n===R.create?d.run(e):G(C(N({},e),{id:f.id}),j)},visible:!!n,title:`${pe[n]}\u7528\u6237\u7EC4`,unmountOnExit:!0,children:s(ue,{initialValues:C(N({},f),{roleName:f==null?void 0:f.name}),form:g,labelLength:8,span:24,formItemConfigList:[{schema:{label:"\u7528\u6237\u7EC4\u540D\u79F0",span:12,field:"roleName",required:!0},control:"input"}]})})),s(V,{style:{width:"700px"},unmountOnExit:!0,confirmLoading:z,onCancel:()=>{k(!1)},onOk:()=>(U(!0),E(()=>m.saveRoleUserByAdmin({roleId:a.id,userIdList:r})).then(()=>{h.run(a.id),k(!1)}).finally(()=>{U(!1)})),visible:L,title:`\u7F16\u8F91 ${a==null?void 0:a.roleName} \u6210\u5458`,children:s(te,{loading:D.loading,className:"flex justify-center",children:s(ie,{listStyle:{width:300},simple:{retainSelectedItems:!0},dataSource:(((y=D.data)==null?void 0:y.list)||[]).toSorted((e,F)=>Number(r.includes(e.id))-Number(r.includes(F.id))).map(e=>({key:e.id,value:e.userLoginAccount}))||[],showSearch:!0,targetKeys:r||[],onChange:e=>{x(e)},titleTexts:["\u7528\u6237\u5217\u8868","\u5DF2\u6DFB\u52A0"]})})})]})}})})}export{Ge as default};
