import{r as m,a6 as Y,a7 as Z,b as M,j as y,a8 as B,a9 as q,m as ee,aa as re,ab as ne,ac as te,ad as ie,B as J,M as ae}from"./vendor.eb7e7369.js";/* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css               */import{a as oe,u as se}from"./index.f62b7de2.js";import{l as ue,s as R}from"./index.module.ddb54cb0.js";import{u as W,_ as h,a as b,d as ce,b as P,c as H,i as N,e as k,f as G,g as le,h as fe,j as I,k as C,l as de}from"./isBrowser.86b03877.js";import{a as ve}from"./index.224556eb.js";var K=function(e,r){var n=r.manual,t=r.ready,a=t===void 0?!0:t,s=r.defaultParams,o=s===void 0?[]:s,f=r.refreshDeps,c=f===void 0?[]:f,i=r.refreshDepsAction,v=m.exports.useRef(!1);return v.current=!1,W(function(){!n&&a&&(v.current=!0,e.run.apply(e,h([],b(o),!1)))},[a]),W(function(){v.current||n||(v.current=!0,i?i():e.refresh())},h([],b(c),!1)),{onBefore:function(){if(!a)return{stopNow:!0}}}};K.onInit=function(e){var r=e.ready,n=r===void 0?!0:r,t=e.manual;return{loading:!t&&n}};var me=K;function Q(e,r){var n=m.exports.useRef({deps:r,obj:void 0,initialized:!1}).current;return(n.initialized===!1||!ce(n.deps,r))&&(n.deps=r,n.obj=e(),n.initialized=!0),n.obj}var O=new Map,ge=function(e,r,n){var t=O.get(e);(t==null?void 0:t.timer)&&clearTimeout(t.timer);var a=void 0;r>-1&&(a=setTimeout(function(){O.delete(e)},r)),O.set(e,P(P({},n),{timer:a}))},pe=function(e){return O.get(e)},F=new Map,he=function(e){return F.get(e)},be=function(e,r){F.set(e,r),r.then(function(n){return F.delete(e),n}).catch(function(){F.delete(e)})},S={},ye=function(e,r){S[e]&&S[e].forEach(function(n){return n(r)})},_=function(e,r){return S[e]||(S[e]=[]),S[e].push(r),function(){var t=S[e].indexOf(r);S[e].splice(t,1)}},Pe=function(e,r){var n=r.cacheKey,t=r.cacheTime,a=t===void 0?5*60*1e3:t,s=r.staleTime,o=s===void 0?0:s,f=r.setCache,c=r.getCache,i=m.exports.useRef(),v=m.exports.useRef(),d=function(l,u){f?f(u):ge(l,a,u),ye(l,u.data)},p=function(l,u){return u===void 0&&(u=[]),c?c(u):pe(l)};return Q(function(){if(!!n){var l=p(n);l&&Object.hasOwnProperty.call(l,"data")&&(e.state.data=l.data,e.state.params=l.params,(o===-1||new Date().getTime()-l.time<=o)&&(e.state.loading=!1)),i.current=_(n,function(u){e.setState({data:u})})}},[]),H(function(){var l;(l=i.current)===null||l===void 0||l.call(i)}),n?{onBefore:function(l){var u=p(n,l);return!u||!Object.hasOwnProperty.call(u,"data")?{}:o===-1||new Date().getTime()-u.time<=o?{loading:!1,data:u==null?void 0:u.data,error:void 0,returnNow:!0}:{data:u==null?void 0:u.data,error:void 0}},onRequest:function(l,u){var g=he(n);return g&&g!==v.current?{servicePromise:g}:(g=l.apply(void 0,h([],b(u),!1)),v.current=g,be(n,g),{servicePromise:g})},onSuccess:function(l,u){var g;n&&((g=i.current)===null||g===void 0||g.call(i),d(n,{data:l,params:u,time:new Date().getTime()}),i.current=_(n,function(L){e.setState({data:L})}))},onMutate:function(l){var u;n&&((u=i.current)===null||u===void 0||u.call(i),d(n,{data:l,params:e.state.params,time:new Date().getTime()}),i.current=_(n,function(g){e.setState({data:g})}))}}:{}},we=Pe,xe=function(e,r){var n=r.debounceWait,t=r.debounceLeading,a=r.debounceTrailing,s=r.debounceMaxWait,o=m.exports.useRef(),f=m.exports.useMemo(function(){var c={};return t!==void 0&&(c.leading=t),a!==void 0&&(c.trailing=a),s!==void 0&&(c.maxWait=s),c},[t,a,s]);return m.exports.useEffect(function(){if(n){var c=e.runAsync.bind(e);return o.current=Y(function(i){i()},n,f),e.runAsync=function(){for(var i=[],v=0;v<arguments.length;v++)i[v]=arguments[v];return new Promise(function(d,p){var l;(l=o.current)===null||l===void 0||l.call(o,function(){c.apply(void 0,h([],b(i),!1)).then(d).catch(p)})})},function(){var i;(i=o.current)===null||i===void 0||i.cancel(),e.runAsync=c}}},[n,f]),n?{onCancel:function(){var c;(c=o.current)===null||c===void 0||c.cancel()}}:{}},Re=xe,Se=function(e,r){var n=r.loadingDelay,t=r.ready,a=m.exports.useRef();if(!n)return{};var s=function(){a.current&&clearTimeout(a.current)};return{onBefore:function(){return s(),t!==!1&&(a.current=setTimeout(function(){e.setState({loading:!0})},n)),{loading:!1}},onFinally:function(){s()},onCancel:function(){s()}}},Ce=Se;function U(){return N?document.visibilityState!=="hidden":!0}var j=[];function Te(e){return j.push(e),function(){var n=j.indexOf(e);j.splice(n,1)}}if(N){var je=function(){if(!!U())for(var e=0;e<j.length;e++){var r=j[e];r()}};window.addEventListener("visibilitychange",je,!1)}var Ae=function(e,r){var n=r.pollingInterval,t=r.pollingWhenHidden,a=t===void 0?!0:t,s=r.pollingErrorRetryCount,o=s===void 0?-1:s,f=m.exports.useRef(),c=m.exports.useRef(),i=m.exports.useRef(0),v=function(){var d;f.current&&clearTimeout(f.current),(d=c.current)===null||d===void 0||d.call(c)};return W(function(){n||v()},[n]),n?{onBefore:function(){v()},onError:function(){i.current+=1},onSuccess:function(){i.current=0},onFinally:function(){o===-1||o!==-1&&i.current<=o?f.current=setTimeout(function(){!a&&!U()?c.current=Te(function(){e.refresh()}):e.refresh()},n):i.current=0},onCancel:function(){v()}}:{}},Le=Ae;function Ee(e,r){var n=!1;return function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];n||(n=!0,e.apply(void 0,h([],b(t),!1)),setTimeout(function(){n=!1},r))}}function Me(){return N&&typeof navigator.onLine!="undefined"?navigator.onLine:!0}var A=[];function Ne(e){return A.push(e),function(){var n=A.indexOf(e);n>-1&&A.splice(n,1)}}if(N){var X=function(){if(!(!U()||!Me()))for(var e=0;e<A.length;e++){var r=A[e];r()}};window.addEventListener("visibilitychange",X,!1),window.addEventListener("focus",X,!1)}var Oe=function(e,r){var n=r.refreshOnWindowFocus,t=r.focusTimespan,a=t===void 0?5e3:t,s=m.exports.useRef(),o=function(){var f;(f=s.current)===null||f===void 0||f.call(s)};return m.exports.useEffect(function(){if(n){var f=Ee(e.refresh.bind(e),a);s.current=Ne(function(){f()})}return function(){o()}},[n,a]),H(function(){o()}),{}},Fe=Oe,De=function(e,r){var n=r.retryInterval,t=r.retryCount,a=m.exports.useRef(),s=m.exports.useRef(0),o=m.exports.useRef(!1);return t?{onBefore:function(){o.current||(s.current=0),o.current=!1,a.current&&clearTimeout(a.current)},onSuccess:function(){s.current=0},onError:function(){if(s.current+=1,t===-1||s.current<=t){var f=n!=null?n:Math.min(1e3*Math.pow(2,s.current),3e4);a.current=setTimeout(function(){o.current=!0,e.refresh()},f)}else s.current=0},onCancel:function(){s.current=0,a.current&&clearTimeout(a.current)}}:{}},$e=De,Be=function(e,r){var n=r.throttleWait,t=r.throttleLeading,a=r.throttleTrailing,s=m.exports.useRef(),o={};return t!==void 0&&(o.leading=t),a!==void 0&&(o.trailing=a),m.exports.useEffect(function(){if(n){var f=e.runAsync.bind(e);return s.current=Z(function(c){c()},n,o),e.runAsync=function(){for(var c=[],i=0;i<arguments.length;i++)c[i]=arguments[i];return new Promise(function(v,d){var p;(p=s.current)===null||p===void 0||p.call(s,function(){f.apply(void 0,h([],b(c),!1)).then(v).catch(d)})})},function(){var c;e.runAsync=f,(c=s.current)===null||c===void 0||c.cancel()}}},[n,t,a]),n?{onCancel:function(){var f;(f=s.current)===null||f===void 0||f.cancel()}}:{}},We=Be,He=function(e){k&&(G(e)||console.error('useMount: parameter `fn` expected to be a function, but got "'.concat(typeof e,'".'))),m.exports.useEffect(function(){e==null||e()},[])},_e=He,Ue=function(){var e=b(m.exports.useState({}),2),r=e[1];return m.exports.useCallback(function(){return r({})},[])},ze=Ue,Ve=function(){function e(r,n,t,a){a===void 0&&(a={}),this.serviceRef=r,this.options=n,this.subscribe=t,this.initState=a,this.count=0,this.state={loading:!1,params:void 0,data:void 0,error:void 0},this.state=P(P(P({},this.state),{loading:!n.manual}),a)}return e.prototype.setState=function(r){r===void 0&&(r={}),this.state=P(P({},this.state),r),this.subscribe()},e.prototype.runPluginHandler=function(r){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];var a=this.pluginImpls.map(function(s){var o;return(o=s[r])===null||o===void 0?void 0:o.call.apply(o,h([s],b(n),!1))}).filter(Boolean);return Object.assign.apply(Object,h([{}],b(a),!1))},e.prototype.runAsync=function(){for(var r,n,t,a,s,o,f,c,i,v,d=[],p=0;p<arguments.length;p++)d[p]=arguments[p];return le(this,void 0,void 0,function(){var l,u,g,L,D,z,$,E,w,x,V;return fe(this,function(T){switch(T.label){case 0:if(this.count+=1,l=this.count,u=this.runPluginHandler("onBefore",d),g=u.stopNow,L=g===void 0?!1:g,D=u.returnNow,z=D===void 0?!1:D,$=I(u,["stopNow","returnNow"]),L)return[2,new Promise(function(){})];if(this.setState(P({loading:!0,params:d},$)),z)return[2,Promise.resolve($.data)];(n=(r=this.options).onBefore)===null||n===void 0||n.call(r,d),T.label=1;case 1:return T.trys.push([1,3,,4]),E=this.runPluginHandler("onRequest",this.serviceRef.current,d).servicePromise,E||(E=(V=this.serviceRef).current.apply(V,h([],b(d),!1))),[4,E];case 2:return w=T.sent(),l!==this.count?[2,new Promise(function(){})]:(this.setState({data:w,error:void 0,loading:!1}),(a=(t=this.options).onSuccess)===null||a===void 0||a.call(t,w,d),this.runPluginHandler("onSuccess",w,d),(o=(s=this.options).onFinally)===null||o===void 0||o.call(s,d,w,void 0),l===this.count&&this.runPluginHandler("onFinally",d,w,void 0),[2,w]);case 3:if(x=T.sent(),l!==this.count)return[2,new Promise(function(){})];throw this.setState({error:x,loading:!1}),(c=(f=this.options).onError)===null||c===void 0||c.call(f,x,d),this.runPluginHandler("onError",x,d),(v=(i=this.options).onFinally)===null||v===void 0||v.call(i,d,void 0,x),l===this.count&&this.runPluginHandler("onFinally",d,void 0,x),x;case 4:return[2]}})})},e.prototype.run=function(){for(var r=this,n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];this.runAsync.apply(this,h([],b(n),!1)).catch(function(a){r.options.onError||console.error(a)})},e.prototype.cancel=function(){this.count+=1,this.setState({loading:!1}),this.runPluginHandler("onCancel")},e.prototype.refresh=function(){this.run.apply(this,h([],b(this.state.params||[]),!1))},e.prototype.refreshAsync=function(){return this.runAsync.apply(this,h([],b(this.state.params||[]),!1))},e.prototype.mutate=function(r){var n=G(r)?r(this.state.data):r;this.runPluginHandler("onMutate",n),this.setState({data:n})},e}(),qe=Ve;function Je(e,r,n){r===void 0&&(r={}),n===void 0&&(n=[]);var t=r.manual,a=t===void 0?!1:t,s=I(r,["manual"]);k&&r.defaultParams&&!Array.isArray(r.defaultParams)&&console.warn("expected defaultParams is array, got ".concat(typeof r.defaultParams));var o=P({manual:a},s),f=de(e),c=ze(),i=Q(function(){var v=n.map(function(d){var p;return(p=d==null?void 0:d.onInit)===null||p===void 0?void 0:p.call(d,o)}).filter(Boolean);return new qe(f,o,c,Object.assign.apply(Object,h([{}],b(v),!1)))},[]);return i.options=o,i.pluginImpls=n.map(function(v){return v(i,o)}),_e(function(){if(!a){var v=i.state.params||r.defaultParams||[];i.run.apply(i,h([],b(v),!1))}}),H(function(){i.cancel()}),{loading:i.state.loading,data:i.state.data,error:i.state.error,params:i.state.params||[],cancel:C(i.cancel.bind(i)),refresh:C(i.refresh.bind(i)),refreshAsync:C(i.refreshAsync.bind(i)),run:C(i.run.bind(i)),runAsync:C(i.runAsync.bind(i)),mutate:C(i.mutate.bind(i))}}function ke(e,r,n){return Je(e,r,h(h([],b(n||[]),!1),[Re,Ce,Le,Fe,We,me,we,$e],!1))}const Ge="",Ie=ve.create({baseURL:Ge,timeout:10*1e3}),Ke=e=>{const{userLoginAccount:r,userLoginPassword:n,captcha:t}=e;return Ie.post("/api/system/login",{captcha:t,userLoginAccount:r,userLoginPassword:n})};function or(){const e=m.exports.useRef(),[r,n]=m.exports.useState(""),[t,a,s]=oe("loginParams"),o=se(ue),[f,c]=m.exports.useState(!!t),{run:i,loading:v,data:d}=ke(async u=>{const g=await Ke(u);console.log(g),g.data.code===0||ae.error(g.data.msg||o["login.form.login.errMsg"]),p(u)},{});console.log(d);function p(u){f?a(JSON.stringify(u)):s(),localStorage.setItem("userStatus","login"),window.location.href="/"}function l(){e.current.validate().then(u=>{i(u)})}return m.exports.useEffect(()=>{const u=!!t;if(c(u),e.current&&u){const g=JSON.parse(t);e.current.setFieldsValue(g)}},[t]),M("div",{className:R["login-form-wrapper"],children:[y("div",{className:R["login-form-title"],children:o["login.form.title"]}),y("div",{className:R["login-form-sub-title"],children:o["login.form.title"]}),y("div",{className:R["login-form-error-msg"],children:r}),M(B,{className:R["login-form"],layout:"vertical",ref:e,initialValues:{userName:"admin",password:"admin"},children:[y(B.Item,{field:"userLoginAccount",rules:[{required:!0,message:o["login.form.userName.errMsg"]}],children:y(q,{prefix:y(ee,{}),placeholder:o["login.form.userName.placeholder"],onPressEnter:l})}),y(B.Item,{field:"userLoginPassword",rules:[{required:!0,message:o["login.form.password.errMsg"]}],children:y(q.Password,{prefix:y(re,{}),placeholder:o["login.form.password.placeholder"],onPressEnter:l})}),M(ne,{size:16,direction:"vertical",children:[M("div",{className:R["login-form-password-actions"],children:[y(te,{checked:f,onChange:c,children:o["login.form.rememberPassword"]}),y(ie,{children:o["login.form.forgetPassword"]})]}),y(J,{type:"primary",long:!0,onClick:l,loading:v,children:o["login.form.login"]}),y(J,{type:"text",long:!0,className:R["login-form-register-btn"],children:o["login.form.register"]})]})]})]})}export{or as default};
