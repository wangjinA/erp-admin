var le=Object.defineProperty,ue=Object.defineProperties;var de=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var G=(a,t,e)=>t in a?le(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,c=(a,t)=>{for(var e in t||(t={}))me.call(t,e)&&G(a,e,t[e]);if(K)for(var e of K(t))he.call(t,e)&&G(a,e,t[e]);return a},y=(a,t)=>ue(a,de(t));import{R as fe,r as I,af as N,j as r,_ as pe,ag as W,ae as Se,aA as Ce,d as P,l as ge,c as ye,s as q,B as b,aB as Fe,aC as xe,aD as Ie,aE as Pe,aF as be,aG as we,M as Ve}from"./vendor.7897a533.js";/* empty css               *//* empty css               */import{a as B}from"./index.627cc3c6.js";import{F as _}from"./index.0400ad0b.js";import{P as ve}from"./index.15739c72.js";import{S as j,F as je,a as ke}from"./index.70508b9f.js";const X=fe.createContext({}),$e=a=>{const{formRef:t,children:e,createRequest:s,updateRequest:o,refreshRequest:n}=a,[S,l]=I.exports.useState(null),d=N(async h=>{s&&(await B(()=>s(h)),t==null||t.resetFields(),l(null),n==null||n())},{manual:!0}),m=N(async h=>{o&&(await B(()=>o(h)),t==null||t.resetFields(),l(null),n==null||n())},{manual:!0});return r(X.Provider,{value:{showType:S,setShowType:l,createAction:d,updateAction:m},children:e})};function Y(a={}){return Object.entries(a).reduce((t,[e,s])=>{if(["",null,void 0].includes(s))return t;const o=JSON.stringify(s);return t?`${t}&${e}=${encodeURIComponent(o)}`:`?${e}=${encodeURIComponent(o)}`},"")}function De(a=location.search.slice(1)){if(!a)return{};const t=a.split("&"),e={};for(const s of t){const[o,n]=s.split("=");try{e[o]=JSON.parse(decodeURIComponent(n))}catch{e[o]=n}}return e}const Z=new Map;function Ee(a){const{initialValues:t,cacheId:e,isSearchParams:s=!0}=a,o=pe(),[n,S]=I.exports.useState(c(c(c({},t),e?Z.get(e):{}),s?De():{}));return I.exports.useEffect(()=>{if(s){const d=Y(n);o.replace({search:d})}e&&Z.set(e,n)},[n,s,e]),{value:n,setValue:S,resetParams:d=>{const m=d||t;if(s){const h=Y(m);o.replace({search:h})}return S(m),m}}}const Re=I.exports.forwardRef((a,t)=>{const{name:e,formItemConfigList:s,isSearchParams:o=!0,className:n,style:S,majorKey:l="id",tableProps:d,formProps:m,initialValues:h={},createInitialValue:te={},showActions:ae=!0,requestQueryTransform:O,leftTool:k,onView:H,createRequest:$,createHandle:D,getListRequest:E,updateRequest:Q,removeRequest:U}=a,[F]=W.useForm(),[R]=W.useForm(),{value:L,setValue:se,resetParams:re}=Ee({initialValues:h,isSearchParams:o}),[T,ne]=Se(`${e}-page-size`,{defaultValue:10}),[C,z]=Ce(`${e}-page-num`,{defaultValue:1}),{data:g,run:x,loading:M}=N(()=>E==null?void 0:E(y(c({},O?O(L):L),{pageNum:C,pageSize:T})).then(f=>{const p=f.data.data;if(p.total&&p.list.length===0&&C!==1){z(C-1);return}return p}),{refreshDeps:[T,C]});I.exports.useImperativeHandle(t,()=>({refreshSearchTable:x}));const w=s.some(f=>f.isSearch),oe=w||$;return r($e,{formRef:F,createRequest:$,updateRequest:Q,refreshRequest:x,children:r(X.Consumer,{children:({showType:f,setShowType:p,createAction:V,updateAction:A})=>P("div",{className:n,style:S,children:[w?r(_,y(c({},m),{form:R,initialValues:L,formItemConfigList:ee(s,"isSearch"),onValuesChange:(i,u)=>{se(u)}})):null,oe?P("div",{className:ye("flex justify-between pr-2",w?"py-6":"pb-6"),children:[P(q,{size:20,children:[($||D)&&r(b,{type:"primary",onClick:()=>{D?D():p(j.create)},icon:r(Fe,{}),children:"\u65B0\u5EFA"}),k==null?void 0:k()]}),w?P(q,{size:20,children:[r(b,{type:"default",loading:M,icon:r(xe,{}),onClick:()=>{R.clearFields(),R.setFieldsValue(re()),setTimeout(()=>{C===1?x():z(1)})},children:"\u91CD\u7F6E"}),r(b,{type:"primary",icon:r(Ie,{}),loading:M,onClick:()=>x(),children:"\u67E5\u8BE2"})]}):null]}):null,r(Pe,y(c({rowKey:l,pagination:{pageSize:T,current:C,total:g==null?void 0:g.total,showTotal:!0,sizeCanChange:!0,onChange(i,u){z(i),ne(u)}},data:g==null?void 0:g.list,loading:M},d),{columns:[...Le(s.filter(i=>!i.hideTable&&i.schema.field!=="actions")),...ae?[{title:"\u64CD\u4F5C",key:"actions",width:315,render:(i,u,ie)=>{var v,J;return P(q,{size:0,children:[H&&r(b,{type:"text",icon:r(be,{}),onClick:()=>{H(u)},children:"\u67E5\u770B"}),(J=(v=s.find(ce=>ce.schema.field==="actions"))==null?void 0:v.render)==null?void 0:J.call(v,i,u,ie),Q&&r(b,{type:"text",status:"warning",icon:r(we,{}),onClick:()=>{p(j.edit),F.setFieldsValue(u)},children:"\u7F16\u8F91"}),U&&r(ve,{buttonProps:{type:"text"},onOk:()=>B(()=>U(u[l])).then(()=>{x()})})]})}}]:[]]})),r(Ve,y(c({},je),{confirmLoading:(V==null?void 0:V.loading)||A.loading,onCancel:()=>{p(null),F.resetFields()},onOk:async()=>{const i=await F.validate();switch(f){case j.create:V.run(i);break;case j.edit:A.run(i);break}},visible:!!f,title:`${ke[f]}${e}`,children:r(_,{initialValues:te,form:F,labelLength:8,span:12,formItemConfigList:[...ee(s,"isCreate"),{schema:{field:l},formItemProps:{hidden:!0}}]})}))]})})})});function ee(a,t){return a.filter(e=>e[t]).map(e=>ge.exports.omit(e,["isCreate","isSearch"]))}function Le(a){return a.filter(e=>{var s;return!((s=e.formItemProps)==null?void 0:s.hidden)}).map(e=>y(c({},e),{title:e.title||e.schema.label,dataIndex:e.schema.field}))}var Qe=Re;export{X as A,$e as C,Qe as S};
